# 表结构

---

## 🗂️ 1. `visitors` — 主访客表


| 字段名       | 类型         | 描述                     |
| ------------ | ------------ | ------------------------ |
| `id`         | INT, PK      | 主键，自增               |
| `name`       | VARCHAR(100) | 访客姓名                 |
| `phone`      | VARCHAR(20)  | 手机号                   |
| `id_card`    | VARCHAR(20)  | 身份证号                 |
| `company`    | VARCHAR(100) | 所属单位                 |
| `created_at` | DATETIME     | 创建时间（默认当前时间） |

---

## 🗂️ 2. `companions` — 随行人员表（隶属主访客）


| 字段名       | 类型         | 描述                         |
| ------------ | ------------ | ---------------------------- |
| `id`         | INT, PK      | 主键，自增                   |
| `visitor_id` | INT, FK      | 所属访客 ID →`visitors(id)` |
| `name`       | VARCHAR(100) | 随行人姓名                   |
| `phone`      | VARCHAR(20)  | 随行人手机号                 |
| `id_card`    | VARCHAR(20)  | 随行人身份证号               |

---

## 🗂️ 3. `visit_forms` — 访问表单（一次访问记录）


| 字段名         | 类型         | 描述                           |
| -------------- | ------------ | ------------------------------ |
| `id`           | INT, PK      | 主键，自增                     |
| `visitor_id`   | INT, FK      | 对应主访客 ID →`visitors(id)` |
| `visit_reason` | TEXT         | 访问原因                       |
| `visit_time`   | DATETIME     | 访问时间                       |
| `location`     | VARCHAR(100) | 访问地点                       |
| `host_name`    | VARCHAR(100) | 被访问人姓名                   |
| `host_phone`   | VARCHAR(20)  | 被访问人手机号                 |
| `created_at`   | DATETIME     | 表单提交时间（默认当前时间）   |

---

## 🗂️ 4. `attendees` — 访问参与人（主访客 + 随行人）


| 字段名        | 类型                                 | 描述                                 |
| ------------- | ------------------------------------ | ------------------------------------ |
| `id`          | INT, PK                              | 主键，自增                           |
| `form_id`     | INT, FK                              | 所属访问表单 ID →`visit_forms(id)`  |
| `name`        | VARCHAR(100)                         | 姓名                                 |
| `role`        | ENUM('visitor', 'companion')         | 角色（主访客 / 随行人）              |
| `original_id` | INT                                  | 对应`visitors.id` 或 `companions.id` |
| `phone`       | VARCHAR(20)                          | 手机号（冗余字段，便于快速查询）     |
| `id_card`     | VARCHAR(20)                          | 身份证号（冗余字段）                 |
| **唯一约束**  | `UNIQUE(form_id, role, original_id)` | 防止重复参与人记录                   |

---

## 🗂️ 5. `users` — 后台管理用户（可选）


| 字段名          | 类型                    | 描述                            |
| --------------- | ----------------------- | ------------------------------- |
| `id`            | INT, PK                 | 主键，自增                      |
| `username`      | VARCHAR(50), UNIQUE     | 登录用户名                      |
| `password_hash` | VARCHAR(255)            | 密码哈希值                      |
| `role`          | ENUM('admin', 'viewer') | 用户角色（管理员 / 只读查看者） |

---


| 表关系                     | 类型         | 说明                              |
| -------------------------- | ------------ | --------------------------------- |
| `visitors`→`companions`   | 一对多 (1:N) | 一个访客可有多个随行人            |
| `visitors`→`visit_forms`  | 一对多 (1:N) | 一个访客可提交多个访问表单        |
| `visit_forms`→`attendees` | 一对多 (1:N) | 一个表单可包含多个参与人（主+随） |
| `attendees.original_id`    |              | 指向`visitors`或`companions`      |


|  |  |  |
| - | - | - |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
-- MySQL Script generated by MySQL Workbench
-- Thu May 22 16:56:16 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
-- -----------------------------------------------------
-- Schema visitor
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema visitor
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `visitor` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`Host`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Host` (
  `id` INT NOT NULL COMMENT '被访问人id',
  `name` VARCHAR(100) NOT NULL,
  `phone` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;

USE `visitor` ;

-- -----------------------------------------------------
-- Table `visitor`.`visitforms`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `visitor`.`visitforms` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `visit_reason` TEXT NULL DEFAULT NULL COMMENT '拜访理由',
  `visit_time` DATETIME NOT NULL COMMENT '拜访时间',
  `location` VARCHAR(100) NOT NULL COMMENT '访问地址',
  `visitformscol` VARCHAR(45) NULL,
  `arrival_time` VARCHAR(45) NOT NULL COMMENT '到访时间',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '表单创建时间',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`, `visit_time`, `location`))
ENGINE = InnoDB
AUTO_INCREMENT = 2
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `visitor`.`visitors`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `visitor`.`visitors` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL,
  `phone` VARCHAR(20) NOT NULL,
  `id_card` VARCHAR(20) NOT NULL,
  `company` VARCHAR(100) NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 2
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `visitor`.`attendees`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `visitor`.`attendees` (
  `id` INT NULL AUTO_INCREMENT,
  `form_id` INT NULL,
  `host_id` VARCHAR(100) NOT NULL,
  `visit_id` VARCHAR(100) NOT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `isMainRole` TINYINT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  CONSTRAINT `id`
    FOREIGN KEY ()
    REFERENCES `mydb`.`Host` ()
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  CONSTRAINT `id`
    FOREIGN KEY (`id`)
    REFERENCES `visitor`.`visitforms` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id`
    FOREIGN KEY ()
    REFERENCES `visitor`.`visitors` ()
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
AUTO_INCREMENT = 3
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `visitor`.`sequelizemeta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `visitor`.`sequelizemeta` (
  `name` VARCHAR(255) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  PRIMARY KEY (`name`),
  UNIQUE INDEX `name` (`name` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `visitor`.`users`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `visitor`.`users` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(50) NOT NULL,
  `password_hash` VARCHAR(255) NOT NULL,
  `role` ENUM('admin', 'viewer') NOT NULL DEFAULT 'viewer',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `username` (`username` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
